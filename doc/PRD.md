# Mini IPTV Player - 产品需求文档 (PRD)

## 1. 产品概述

Mini IPTV Player 是一款轻量级的移动端 IPTV 播放器应用，支持 iOS 和 Android 平台。用户可以通过添加 M3U 源来观看网络电视直播，支持频道收藏、播放历史、投屏等功能。

### 1.1 产品愿景

为用户提供简洁、高效的 IPTV 观看体验，无需复杂配置即可享受网络电视直播。

### 1.2 核心价值

- **简单易用**：开箱即用，默认提供可用的 IPTV 源
- **轻量快速**：专注核心功能，启动快、占用少
- **纯本地化**：无需账号，数据存储在本地，保护用户隐私

## 2. 目标用户

- 希望在移动设备上观看网络电视直播的用户
- 对 IPTV/M3U 有一定了解的用户
- 追求简洁体验、不喜欢臃肿应用的用户

## 3. 功能需求

### 3.1 IPTV 源管理

| 项目 | 描述 |
|------|------|
| 入口位置 | 设置页面 |
| 默认源 | `https://iptv-org.github.io/iptv/countries/cn.m3u` |
| 功能 | 添加、编辑、删除 M3U 源 |
| 格式支持 | 标准 M3U/M3U8 格式 |

**用户故事**：
- 作为用户，我希望应用预置一个可用的 IPTV 源，这样我无需配置即可使用
- 作为用户，我希望能添加自己的 M3U 源地址
- 作为用户，我希望能管理（编辑/删除）已添加的源

### 3.2 频道列表与搜索

| 项目 | 描述 |
|------|------|
| 布局方式 | 默认列表布局，可切换卡片网格布局 |
| 分组展示 | 按 M3U 中的 `group-title` 字段分组，支持折叠/展开 |
| 搜索 | 顶部全局搜索框，按频道名称搜索 |
| 排序 | 支持按名称、状态、最近观看排序 |

**频道状态检测**：
- 采用懒加载检测，仅检测当前可视区域内的频道
- 状态指示：绿色（可用）、红色（不可用）、灰色（未检测）

**用户故事**：
- 作为用户，我希望频道按类别分组展示，方便我快速找到想看的类型
- 作为用户，我希望能搜索频道名称
- 作为用户，我希望知道频道是否可用，避免点击后才发现无法播放

### 3.3 视频播放器

| 项目 | 描述 |
|------|------|
| 支持格式 | HLS (.m3u8)、MP4 |
| 布局 | 分屏布局：上方 16:9 播放器 + 下方频道列表 |
| 控件栏 | 常驻显示，包含：播放/暂停、音量、全屏、投屏 |

**用户故事**：
- 作为用户，我希望播放时能同时看到频道列表，方便切换
- 作为用户，我希望控件栏始终可见，不需要点击才显示

### 3.4 收藏与历史

**收藏功能**：
- 支持标记/取消收藏频道
- 独立的「收藏」Tab 页面展示所有收藏频道

**播放历史**：
- 自动记录最近播放的频道
- 独立的「历史」Tab 页面展示播放记录

**用户故事**：
- 作为用户，我希望能收藏常看的频道，方便快速访问
- 作为用户，我希望能看到最近播放的频道，快速继续观看

### 3.5 投屏功能

| 协议 | 支持情况 |
|------|----------|
| AirPlay | 支持（iOS 系统原生） |
| Chromecast | 支持（通过 Google Cast SDK） |

**用户故事**：
- 作为用户，我希望能将视频投屏到电视上观看

### 3.6 EPG 电子节目指南

| 项目 | 描述 |
|------|------|
| 数据来源 | 可选关联 XMLTV 格式的 EPG 源 |
| 展示方式 | 卡片式展示当前节目和下一节目 |
| 是否必需 | 可选功能，无 EPG 时正常使用 |

**用户故事**：
- 作为用户，我希望能看到当前正在播放的节目信息

### 3.7 明暗模式

| 项目 | 描述 |
|------|------|
| 默认行为 | 跟随系统设置 |
| 手动切换 | 支持在设置中手动切换明/暗模式 |

### 3.8 离线支持

| 项目 | 描述 |
|------|------|
| 缓存内容 | 频道列表数据 |
| 离线能力 | 可浏览频道列表（无法播放） |
| 刷新机制 | 联网时自动刷新 |

**用户故事**：
- 作为用户，我希望在无网络时仍能查看频道列表

### 3.9 国际化

| 项目 | 描述 |
|------|------|
| 支持语言 | 中文、英文 |
| 切换方式 | 跟随系统语言，或在设置中手动切换 |

## 4. 非功能需求

### 4.1 性能要求

- 应用启动时间 < 2 秒
- 频道列表滚动流畅，无卡顿
- 频道状态检测不阻塞 UI

### 4.2 兼容性要求

- iOS 15.1+（Expo SDK 55 要求）
- Android 7.0+ (API 24+)（Expo SDK 55 要求）

### 4.3 数据安全

- 所有用户数据存储在本地设备
- 不收集、不上传任何用户数据

## 5. 页面状态定义

### 5.1 频道列表页

| 状态 | 描述 |
|------|------|
| 加载中 | 显示加载指示器 |
| 空状态 | 居中图标 + 提示文字「暂无频道，请添加 IPTV 源」 |
| 错误状态 | 显示错误信息 + 重试按钮 |
| 正常状态 | 显示频道列表 |

### 5.2 收藏页

| 状态 | 描述 |
|------|------|
| 空状态 | 居中图标 + 提示文字「暂无收藏」 |
| 正常状态 | 显示收藏的频道列表 |

### 5.3 历史页

| 状态 | 描述 |
|------|------|
| 空状态 | 居中图标 + 提示文字「暂无播放记录」 |
| 正常状态 | 显示播放历史列表 |

### 5.4 播放器

| 状态 | 描述 |
|------|------|
| 加载中 | 播放器区域显示加载指示器 |
| 播放失败 | Toast 提示「播放失败」，用户可手动选择其他频道 |
| 正常播放 | 显示视频内容 |

## 6. 约束与假设

### 6.1 约束

- 纯本地应用，无后端服务
- 依赖第三方 IPTV 源的稳定性
- 投屏功能依赖局域网环境

### 6.2 假设

- 用户的网络环境能够访问所配置的 IPTV 源
- 用户对 M3U 格式有基本了解
- 目标设备支持 HLS 视频播放
